<!DOCTYPE html>

<html lang="en">

    <head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
            integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous"></script>
        <link href="notestyle.css" rel="stylesheet">
        <link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">



        <title>Mary's Note</title>
    </head>

    <body>
        <!-- 导航栏 -->
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand"
                    href="https://vigilant-capybara-7v7v4rwrqj6xfj5r-8080.app.github.dev/index.html">Mary's Blog</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-link" aria-current="page"
                            href="https://vigilant-capybara-7v7v4rwrqj6xfj5r-8080.app.github.dev/book.html">读书</a>
                        <a class="nav-link"
                            href="https://vigilant-capybara-7v7v4rwrqj6xfj5r-8080.app.github.dev/movie.html">电影</a>
                        <a class="nav-link" href="https://vigilant-capybara-7v7v4rwrqj6xfj5r-8080.app.github.dev/note.html">留言板</a>
                    </div>
                </div>
            </div>
        </nav>


        <!-- 本页简介 -->
        <div class="container">
            <header>
                <h1 class="header-title"><i class="em em-email" aria-role="presentation" aria-label="ENVELOPE"></i>互动留言版</h1>
                <p class="subtitle">分享您的想法，留下您的足迹</p>
            </header>
            <!-- 主要内容 -->
            <div class="main-content">
                <section class="message-form">
                    <h1 class="form-title"><i class="em em-lower_left_fountain_pen" aria-role="presentation"
                            aria-label=""></i>发布留言</h2>
                        <form id="messageForm">
                            <div class="form-group">
                                <label for="author">昵称</label>
                                <input type="text" id="author" placeholder="请输入你的昵称">
                            </div>

                            <div class="form-group">
                                <label for="message">留言内容</label>
                                <textarea type="text" id="message" placeholder="请输入留言…"></textarea>
                            </div>

                            <button type="submit" class="submit-btn" id="submitBtn">
                                <i class="em em-airplane" aria-role="presentation" aria-label="AIRPLANE"></i>发布留言
                            </button>
                        </form>
                </section>

                <section class="messages-container">
                    <div class="messages-header">
                        <h1 class="messages-title"><i class="em em-page_with_curl" aria-role="presentation"
                                aria-label="PAGE WITH CURL"></i>留言列表</h2>
                            <div class="message-count" id="messageCount">0条留言</div>
                    </div>

                    <div class="messages-list" id="messagesList">
                        <div class="empty-message">
                            <p>还没有留言，快来第一个发言吧！</p>
                        </div>
                    </div>
                </section>
            </div>

            <footer>
                <p>© 2025 | Mary's Homepage</p>
            </footer>
        </div>

        <script>
            //dom元素
            const messageForm = document.getElementById('messageForm');
            const authorInput = document.getElementById('author');
            const messageInput = document.getElementById('message');
            const submitBtn = document.getElementById('submitBtn');
            const messagesList = document.getElementById('messagesList');
            const messageCount = document.getElementById('messageCount');

            //从本地存储加载留言或者初始化数组
            let messages = JSON.parse(localStorage.getItem('messages')) || [];

            //初始化页面
            document.addEventListener('DOMContentLoaded', () => {
                renderMessages();
            });

            // 表单提交处理
            messageForm.addEventListener('submit', (e) => {
                e.preventDefault();//阻止表单默认提交，页面不刷新。

                const author = authorInput.value;
                const content = messageInput.value;
                const timestamp = new Date().toISOString();

                if (!author || !content) {
                    alert('请填写昵称和留言内容！');
                    return;
                }

                // 创建新留言对象
                const newMessage = {
                    id: Date.now(), // 使用时间戳作为唯一ID
                    author,
                    content,
                    timestamp //只存储ISO时间戳
                    //不存储：displayTime: formatTime(new Date())
                };

                // 添加到消息数组开头
                messages.unshift(newMessage);

                // 保存到本地存储
                saveMessages();

                // 重新渲染留言列表
                renderMessages();

                // 重置表单
                messageForm.reset();
            });

            // 保存留言到本地存储
            function saveMessages() {
                localStorage.setItem('messages', JSON.stringify(messages));
            }

            //渲染留言列表
            function renderMessages() {
                // 更新留言数量
                messageCount.textContent = `${messages.length} 条留言`;

                if (messages.length === 0) {
                    messagesList.innerHTML = `
                    <div class="empty-message">
                        <p>还没有留言，快来第一个发言吧！</p>
                    </div>
                `;
                    return;
                }

                // 生成留言HTML
                let messagesHTML = '';

                messages.forEach(message => {
                    //每次渲染时动态计算显示时间。
                    const displayTime = formatTime(new Date(message.timestamp));

                    messagesHTML += `
                    <div class="message" data-id="${message.id}">
                        <div class="message-header">
                            <div class="message-author">
                                ${escapeHtml(message.author)}
                            </div>
                            <div class="message-time">${displayTime}</div>
                        </div>
                        <div class="message-content">${escapeHtml(message.content)}</div>
                    </div>
                `;
                });

                messagesList.innerHTML = messagesHTML;
            }

            // 格式化时间显示
            function formatTime(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));

                if (diffMins < 1) {
                    return '刚刚';
                } else if (diffMins < 60) {
                    return `${diffMins}分钟前`;
                } else if (diffHours < 24) {
                    return `${diffHours}小时前`;
                } else {
                    return date.toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                }
            }

            // 防止XSS攻击的简单HTML转义
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        </script>
    </body>

</html>
